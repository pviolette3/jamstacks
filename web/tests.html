<!DOCTYPE html>
<html>
<head>
    <title>JamServer Tests</title>
    <script type="text/javascript">
    try {
        eval('class __DoesTheBrowserSuck {}');
    } catch (e) {
        alert('Your browser doesnt support the glory ' + 
              'of React.JS -- sorry no jamz for you!!');
    }
    </script>
    <script src="./lib/protobuf.js"></script>
    <script src="./proto/jam.proto.js"></script>
    <script src="./lib/freezer.js"></script>
    <script src="./lib/react.js"></script>
    <script src="./lib/react-dom.js"></script>
    <script src="./jam.js"></script>
    <style>
        .test-pane {
            margin: 20px;
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <div><i>Tests of all the components.</i></div><br/>
    <div id="card" class="test-pane"></div>
    <div id="card-list" class="test-pane"></div>
    <div id="panel" class="test-pane"></div>
    <div id="board" class="test-pane"></div>
</body>
<script type="text/javascript">
    // A "simple" function that updates the subcomponent when the freezer
    // object is updated.
    function makeApp(nodeType, freezer, getProps) {
        class _App extends React.Component {
            componentDidMount() {
                var me = this;
                freezer.on('update', function() { me.forceUpdate(); });
            }
            render() {
                return React.createElement(nodeType, freezer.get());
            }
        }
        return _App;
    }
</script>
<script type="text/javascript">
    ReactDOM.render(
        React.createElement(Card, {rank: 'QUEEN', suit: 'HEARTS'}),
        document.getElementById('card'));
</script>
<script type="text/javascript">
    ReactDOM.render(
        React.createElement(CardList, {cards: [
            {rank: 'QUEEN', suit: 'HEARTS'},
            {rank: 'KING', suit: 'SPADES'},
            {rank: 'TWO', suit: 'DIAMONDS'}]}),
        document.getElementById('card-list'));
</script>
<script type="text/javascript">
</script>
<script type="text/javascript">
    // Test the board -- PRE-FLOP, FLOP, TURN, RIVER
    (function() {
        var handStateFreezer = new Freezer({
            street: 'PRE_FLOP',
            pot: {
                size:  100,
                currentBet: 45,
            },
            board: {
                cards: [{hidden: true}, {hidden: true}, {hidden: true},
                        {hidden: true}, {hidden: true}],
            }
        });
        var i = 0;
        function updateCard(i, handState) {
        }
        var err = jam_proto.HandState.verify(
            jam_proto.HandState.fromObject(handStateFreezer.get()));
        check(!err, err);
        setInterval(() => {
            var handState = handStateFreezer.get();
            var cards = handState.board.cards.transact();
            var street = null;
            if (i <3/*u*/) {
                // Flop.
                cards.splice(
                    0, 3,
                    {rank: jam_proto.Card.Rank[3], suit: 'CLUBS'},
                    {rank: jam_proto.Card.Rank[4], suit: 'CLUBS'},
                    {rank: jam_proto.Card.Rank[5], suit: 'CLUBS'});
                i = 3;
                street = 'PRE_FLOP';
            } else if (i  == 3) {
                cards.splice(i++, 1,
                    {rank: jam_proto.Card.Rank[6], suit: 'CLUBS'});
                street = 'FLOP';
            } else if (i == 4) {
                cards.splice(i++, 1,
                    {rank: jam_proto.Card.Rank[7], suit: 'CLUBS'});
                street = 'RIVER';
            } else {
                // Reset, for the demo.
                cards.splice(0, 5,
                            {hidden: true}, {hidden: true}, {hidden: true},
                            {hidden: true}, {hidden: true});
                street = 'PRE_FLOP';
                i = 0;
            }
            handState.board.cards.run();
            handStateFreezer.get().set('street', street);
            handStateFreezer.get().pot.set('size', i === 0 ? 8 : handState.pot.size + handState.pot.currentBet);
            handStateFreezer.get().pot.set('currentBet', i === 0 ? 2 : 2 * handState.pot.currentBet);
            var err = jam_proto.HandState.verify(
                jam_proto.HandState.fromObject(handStateFreezer.get()));
            check(!err, err);
        }, 1000);
        ReactDOM.render(
            React.createElement(
            makeApp(Board, handStateFreezer),
            null),
        document.getElementById('board'));
})();
</script>
</html>